---
// Standalone copy button component for code blocks
---

<script>
  function setupCopyButtons() {
    document.querySelectorAll('pre').forEach((block) => {
      if (block.querySelector('.copy-btn')) return;
      
      const btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg> Copy';
      
      btn.onclick = async () => {
        const code = block.querySelector('code') || block;
        try {
          await navigator.clipboard.writeText(code.textContent || '');
          btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
          btn.classList.add('copied');
          setTimeout(() => {
            btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg> Copy';
            btn.classList.remove('copied');
          }, 2000);
        } catch (e) {
          console.error('Copy failed', e);
        }
      };
      
      block.appendChild(btn);
      block.style.position = 'relative';
    });
  }
  
  document.addEventListener('DOMContentLoaded', setupCopyButtons);
  document.addEventListener('astro:after-swap', setupCopyButtons);
</script>

<style is:global>
  pre {
    position: relative !important;
  }
  
  .copy-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.375rem 0.75rem;
    background: rgb(55 65 81);
    color: white;
    border: 1px solid rgb(75 85 99);
    border-radius: 0.375rem;
    font-size: 0.75rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    transition: background 0.2s;
    z-index: 10;
  }
  
  .copy-btn:hover {
    background: rgb(75 85 99);
  }
  
  .copy-btn.copied {
    background: rgb(16 185 129);
    border-color: rgb(16 185 129);
  }
  
  .copy-btn svg {
    flex-shrink: 0;
  }
</style>
